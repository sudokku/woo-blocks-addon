!function(){"use strict";document.addEventListener("change",function(e){if(!e.target.matches(".wcba-sort-select"))return;const t=e.target,r=t.closest(".wcba-product-grid-advanced");if(!r)return;const a=r.id,c=r.getAttribute("data-attributes"),n=r.getAttribute("data-nonce"),o=r.getAttribute("data-ajax-url");if(!(a&&c&&n&&o))return;const[i,d]=t.value.split("|"),s=r.querySelector(".wcba-grid-container");if(!s)return;const l=r.querySelector(".wcba-product-grid");l&&(l.style.opacity="0.5",l.style.pointerEvents="none");const u=new FormData;u.append("action","wcba_sort_products"),u.append("nonce",n),u.append("blockId",a),u.append("attributes",c),u.append("orderBy",i),u.append("order",d),fetch(o,{method:"POST",body:u}).then(e=>e.json()).then(e=>{if(e.success&&e.data&&e.data.html){const t=document.createElement("div");t.innerHTML=e.data.html;const a=t.querySelector(".wcba-grid-container"),c=t.querySelector(".wcba-grid-pagination"),n=t.querySelector(".wcba-grid-loadmore");if(a){s&&s.replaceWith(a);const e=r.querySelector(".wcba-grid-pagination");e&&c?e.replaceWith(c):e&&!c?e.remove():!e&&c&&r.appendChild(c);const t=r.querySelector(".wcba-grid-loadmore");t&&n?t.replaceWith(n):t&&!n?t.remove():!t&&n&&r.appendChild(n)}}}).catch(e=>{console.error("Sort error:",e)}).finally(()=>{const e=r.querySelector(".wcba-product-grid");e&&(e.style.opacity="",e.style.pointerEvents="")})}),document.addEventListener("click",function(e){if(e.target.matches(".wcba-filter-apply")){e.preventDefault();const t=e.target.closest(".wcba-grid-filters");if(!t)return;const r=t.closest(".wcba-product-grid-advanced");if(!r)return;const a=r.id,c=r.getAttribute("data-attributes"),n=r.getAttribute("data-nonce"),o=r.getAttribute("data-ajax-url");if(!(a&&c&&n&&o))return;const i={},d=t.querySelector('[data-filter="category"]');d&&d.selectedOptions.length>0&&(i.categories=Array.from(d.selectedOptions).map(e=>e.value));const s=t.querySelector('[data-filter="price_min"]')?.value,l=t.querySelector('[data-filter="price_max"]')?.value;s&&(i.priceMin=s),l&&(i.priceMax=l);const u=t.querySelector('[data-filter="rating"]');u&&u.value&&(i.rating=u.value);const p=t.querySelector('[data-filter="stock"]');p&&p.checked&&(i.stock="instock");const g=r.querySelector(".wcba-grid-container");g&&(g.style.opacity="0.5",g.style.pointerEvents="none");const b=JSON.parse(c);i.categories&&i.categories.length?(b.querySource="category",b.categories=i.categories):i.tags&&i.tags.length?(b.querySource="tag",b.tags=i.tags):i.categories&&0!==i.categories.length||"category"===b.querySource&&(b.querySource="all",b.categories=[]);const y=new FormData;y.append("action","wcba_filter_products"),y.append("nonce",n),y.append("blockId",a),y.append("attributes",JSON.stringify(b)),y.append("filters",JSON.stringify(i)),fetch(o,{method:"POST",body:y}).then(e=>e.json()).then(e=>{if(e.success&&e.data&&e.data.html){const t=document.createElement("div");t.innerHTML=e.data.html;const a=t.querySelector(".wcba-grid-container"),c=t.querySelector(".wcba-grid-pagination"),n=t.querySelector(".wcba-grid-loadmore");if(a){const e=r.querySelector(".wcba-grid-container");e&&e.replaceWith(a);const t=r.querySelector(".wcba-grid-pagination");t&&c?t.replaceWith(c):t&&!c?t.remove():!t&&c&&r.appendChild(c);const o=r.querySelector(".wcba-grid-loadmore");o&&n?o.replaceWith(n):o&&!n?o.remove():!o&&n&&r.appendChild(n)}}}).catch(e=>{console.error("Filter error:",e)}).finally(()=>{g&&(g.style.opacity="",g.style.pointerEvents="")})}if(e.target.matches(".wcba-filter-reset")){e.preventDefault();const t=e.target.closest(".wcba-grid-filters");if(!t)return;t.querySelectorAll("select, input").forEach(e=>{"checkbox"===e.type?e.checked=!1:"SELECT"===e.tagName&&e.multiple?Array.from(e.options).forEach(e=>{e.selected=!1}):e.value=""});const r=t.querySelector(".wcba-filter-apply");r&&r.click()}}),document.addEventListener("click",function(e){if(!e.target.matches(".wcba-loadmore-btn"))return;e.preventDefault();const t=e.target,r=t.closest(".wcba-product-grid-advanced");if(!r)return;const a=r.id,c=r.getAttribute("data-attributes"),n=r.getAttribute("data-nonce"),o=r.getAttribute("data-ajax-url");if(!(a&&c&&n&&o))return;const i=parseInt(t.getAttribute("data-page"),10),d=parseInt(t.getAttribute("data-max"),10),s=i+1;t.disabled=!0;const l=t.textContent;t.textContent=t.textContent+"...";const u=new FormData;u.append("action","wcba_load_more_products"),u.append("nonce",n),u.append("blockId",a),u.append("attributes",c),u.append("page",s),fetch(o,{method:"POST",body:u}).then(e=>e.json()).then(e=>{if(e.success&&e.data&&e.data.html){const a=r.querySelector(".wcba-product-grid");a&&(a.insertAdjacentHTML("beforeend",e.data.html),s>=d?t.parentElement.remove():(t.setAttribute("data-page",s),t.disabled=!1,t.textContent=l))}}).catch(e=>{console.error("Load more error:",e),t.disabled=!1,t.textContent=l})});let e=null;"IntersectionObserver"in window&&(e=new IntersectionObserver(function(e){e.forEach(e=>{if(e.isIntersecting){const t=e.target.querySelector(".wcba-loadmore-btn");t&&!t.disabled&&t.click()}})},{rootMargin:"100px"}),document.querySelectorAll('.wcba-product-grid-advanced[data-pagination-mode="infinite"] .wcba-grid-loadmore').forEach(t=>{e.observe(t)}))}();