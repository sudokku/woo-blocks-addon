!function(){"use strict";document.addEventListener("change",function(e){if(!e.target.matches(".wcba-sort-select"))return;const t=e.target,r=t.closest(".wcba-product-grid-advanced");if(!r)return;const a=r.id,c=r.getAttribute("data-attributes"),n=r.getAttribute("data-nonce"),o=r.getAttribute("data-ajax-url");if(!(a&&c&&n&&o))return;const[i,d]=t.value.split("|"),l=r.querySelector(".wcba-grid-container");if(!l)return;const s=r.querySelector(".wcba-product-grid");s&&(s.style.opacity="0.5",s.style.pointerEvents="none");const p=new FormData;p.append("action","wcba_sort_products"),p.append("nonce",n),p.append("blockId",a),p.append("attributes",c),p.append("orderBy",i),p.append("order",d),fetch(o,{method:"POST",body:p}).then(e=>e.json()).then(e=>{if(e.success&&e.data&&e.data.html){const t=document.createElement("div");t.innerHTML=e.data.html;const a=t.querySelector(".wcba-grid-container"),c=t.querySelector(".wcba-grid-pagination"),n=t.querySelector(".wcba-grid-loadmore");if(a){l&&l.replaceWith(a);const e=r.querySelector(".wcba-grid-pagination");e&&c?e.replaceWith(c):e&&!c?e.remove():!e&&c&&r.appendChild(c);const t=r.querySelector(".wcba-grid-loadmore");t&&n?t.replaceWith(n):t&&!n?t.remove():!t&&n&&r.appendChild(n)}}}).catch(e=>{console.error("Sort error:",e)}).finally(()=>{const e=r.querySelector(".wcba-product-grid");e&&(e.style.opacity="",e.style.pointerEvents="")})}),document.addEventListener("click",function(e){if(e.target.matches(".wcba-filter-apply")){e.preventDefault();const t=e.target.closest(".wcba-grid-filters");if(!t)return;const r=t.closest(".wcba-product-grid-advanced");if(!r)return;const a=r.id,c=r.getAttribute("data-attributes"),n=r.getAttribute("data-nonce"),o=r.getAttribute("data-ajax-url");if(!(a&&c&&n&&o))return;const i={},d=t.querySelector('[data-filter="category"]');d&&d.selectedOptions.length>0&&(i.categories=Array.from(d.selectedOptions).map(e=>e.value));const l=t.querySelector('[data-filter="price_min"]')?.value,s=t.querySelector('[data-filter="price_max"]')?.value;l&&(i.priceMin=l),s&&(i.priceMax=s);const p=t.querySelector('[data-filter="rating"]');p&&p.value&&(i.rating=p.value);const u=t.querySelector('[data-filter="stock"]');u&&u.checked&&(i.stock="instock");const b=r.querySelector(".wcba-grid-container");b&&(b.style.opacity="0.5",b.style.pointerEvents="none");const g=new FormData;g.append("action","wcba_filter_products"),g.append("nonce",n),g.append("blockId",a),g.append("attributes",c),g.append("filters",JSON.stringify(i)),fetch(o,{method:"POST",body:g}).then(e=>e.json()).then(e=>{if(e.success&&e.data&&e.data.html){const t=document.createElement("div");t.innerHTML=e.data.html;const a=t.querySelector(".wcba-grid-container"),c=t.querySelector(".wcba-grid-pagination"),n=t.querySelector(".wcba-grid-loadmore");if(a){b&&b.replaceWith(a);const e=r.querySelector(".wcba-grid-pagination");e&&c?e.replaceWith(c):e&&!c?e.remove():!e&&c&&r.appendChild(c);const t=r.querySelector(".wcba-grid-loadmore");t&&n?t.replaceWith(n):t&&!n?t.remove():!t&&n&&r.appendChild(n)}}}).catch(e=>{console.error("Filter error:",e)}).finally(()=>{b&&(b.style.opacity="",b.style.pointerEvents="")})}if(e.target.matches(".wcba-filter-reset")){e.preventDefault();const t=e.target.closest(".wcba-grid-filters");if(!t)return;t.querySelectorAll("select, input").forEach(e=>{"checkbox"===e.type?e.checked=!1:e.value=""});const r=t.querySelector(".wcba-filter-apply");r&&r.click()}}),document.addEventListener("click",function(e){if(!e.target.matches(".wcba-loadmore-btn"))return;e.preventDefault();const t=e.target,r=t.closest(".wcba-product-grid-advanced");if(!r)return;const a=r.id,c=r.getAttribute("data-attributes"),n=r.getAttribute("data-nonce"),o=r.getAttribute("data-ajax-url");if(!(a&&c&&n&&o))return;const i=parseInt(t.getAttribute("data-page"),10),d=parseInt(t.getAttribute("data-max"),10),l=i+1;t.disabled=!0;const s=t.textContent;t.textContent=t.textContent+"...";const p=new FormData;p.append("action","wcba_load_more_products"),p.append("nonce",n),p.append("blockId",a),p.append("attributes",c),p.append("page",l),fetch(o,{method:"POST",body:p}).then(e=>e.json()).then(e=>{if(e.success&&e.data&&e.data.html){const a=r.querySelector(".wcba-product-grid");a&&(a.insertAdjacentHTML("beforeend",e.data.html),l>=d?t.parentElement.remove():(t.setAttribute("data-page",l),t.disabled=!1,t.textContent=s))}}).catch(e=>{console.error("Load more error:",e),t.disabled=!1,t.textContent=s})});let e=null;"IntersectionObserver"in window&&(e=new IntersectionObserver(function(e){e.forEach(e=>{if(e.isIntersecting){const t=e.target.querySelector(".wcba-loadmore-btn");t&&!t.disabled&&t.click()}})},{rootMargin:"100px"}),document.querySelectorAll('.wcba-product-grid-advanced[data-pagination-mode="infinite"] .wcba-grid-loadmore').forEach(t=>{e.observe(t)}))}();